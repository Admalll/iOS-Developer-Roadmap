# **Copy On Write**

  - Копирование при записи - это метод оптимизации, который помогает повысить производительность при копировании типов значений.
#

  - Допустим, мы копируем одну строку или Int или, возможно, любой другой тип значения? В этом случае мы не столкнемся с какими-либо решающими проблемами производительности. 
Но как быть, когда мы копируем массив из тысяч элементов? Это все равно не создаст проблем с производительностью? 
Что, если мы просто скопируем его и не внесем никаких изменений в этот экземпляр? 
Разве это не лишняя память, которую мы использовали просто пустая трата в этом случае?
#
  - На сцену выходит понятие **Copy in Write** - при копировании каждая ссылка указывает на один и тот же адрес памяти. Только когда одна из ссылок изменяет базовые данные, Swift фактически копирует исходный экземпляр и вносит изменения.
То есть, будь то **deep copy** или **shallow copy**, новая копия не будет создана, пока мы не внесем изменения в один из объектов.

#
Пример:
![image](https://i.yapx.ru/Ro2j1.png)
#
Реализация COW своими руками:
![image](https://i.yapx.ru/Ro2u5.png)

# **Полезные ссылки**
- [Apple docs](https://github.com/apple/swift/blob/main/docs/OptimizationTips.rst#id28)
